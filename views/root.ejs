<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Shortener</title>
</head>
<body>
  <% if (page === 'home') { %>
    <h1>URL Shortener</h1>
    <form method="POST" action="/api-v2/">
      <input type="text" name="url" placeholder="Enter URL to shorten" required>
      <input type="submit" value="Submit">
    </form>
  <% } else if (page === 'created') { %>
    <h1>Shortened URL Created</h1>
    <p>Your shortened URL: <a href="<%= shortUrl %>"><%= shortUrl %></a></p>
    <button onclick="navigator.clipboard.writeText('<%= shortUrl %>').then(() => alert('URL copied to clipboard!'))">Copy URL</button>
    <% if (typeof secret !== 'undefined') { %>
      <button id="deleteBtn">Supprimer ce lien</button>
      <script>
        document.getElementById('deleteBtn').onclick = async function() {
          if (!confirm('Supprimer ce lien ?')) return;
          const urlPart = '<%= shortUrl.split('/').pop() %>';
          const response = await fetch(`/api-v2/${urlPart}`, {
            method: 'DELETE',
            headers: { 'X-API-Key': '<%= secret %>' }
          });
          if (response.ok) {
            alert('Lien supprim√© !');
            window.location.href = '/';
          } else {
            const data = await response.json();
            alert('Erreur : ' + (data.error || 'Suppression impossible'));
          }
        };
      </script>
    <% } %>
  <% } %>
</body>
</html>
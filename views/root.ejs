<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Shortener</title>
</head>
<body>
  <% if (page === 'home') { %>
    <h1>URL Shortener</h1>
    <form method="POST" action="/api-v2/">
      <input type="text" name="url" placeholder="Enter URL to shorten" required>
      <input type="submit" value="Submit">
    </form>
  <% } else if (page === 'created') { %>
    <h1>Shortened URL Created</h1>
    <p>Your shortened URL: <a href="<%= shortUrl %>"><%= shortUrl %></a></p>
    <button onclick="navigator.clipboard.writeText('<%= shortUrl %>').then(() => alert('URL copied to clipboard!'))">Copy URL</button>
    <% if (typeof secret !== 'undefined') { %>
      <button id="deleteBtn">Supprimer ce lien</button>
      <script>
        document.getElementById('deleteBtn').onclick = async function() {
          if (!confirm('Supprimer ce lien ?')) return;
          const urlPart = '<%= shortUrl.split('/').pop() %>';
          const apiBase = window.location.origin;
          try {
            const response = await fetch(`${apiBase}/api-v2/${urlPart}`, {
              method: 'DELETE',
              headers: { 'X-API-Key': '<%= secret %>' }
            });
            if (response.ok) {
              alert('Lien supprimé !');
              window.location.href = '/';
            } else {
              let data = {};
              try { data = await response.json(); } catch(e) {}
              alert('Erreur : ' + (data.error || 'Suppression impossible'));
            }
          } catch (err) {
            alert('Erreur réseau : ' + err.message);
          }
        };
      </script>
    <% } %>
  <% } %>
</body>
</html>